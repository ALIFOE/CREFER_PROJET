#!/usr/bin/env php
<?php

/**
 * Script de création des utilisateurs test CREFER
 * Crée automatiquement les identifiants pour Enseignant et Admin
 */

// Configuration
define('APP_PATH', __DIR__);

// Charger Laravel
require __DIR__ . '/vendor/autoload.php';
$app = require_once __DIR__ . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Console\Kernel::class);
$kernel->bootstrap();

use App\Models\User;
use Illuminate\Support\Facades\Hash;

echo "\n╔════════════════════════════════════════════════════════╗\n";
echo "║   CREFER - Création des Utilisateurs Test              ║\n";
echo "╚════════════════════════════════════════════════════════╝\n\n";

try {
    // Créer l'utilisateur Enseignant
    echo "📚 Création de l'utilisateur Enseignant...\n";
    
    $enseignant = User::updateOrCreate(
        ['email' => 'enseignant@test.com'],
        [
            'name' => 'Enseignant Test',
            'email' => 'enseignant@test.com',
            'password' => Hash::make('password'),
            'role' => 'enseignant',
            'email_verified_at' => now(),
        ]
    );
    
    echo "✅ Enseignant créé/mis à jour:\n";
    echo "   Email: enseignant@test.com\n";
    echo "   Mot de passe: password\n";
    echo "   Rôle: enseignant\n";
    echo "   ID: " . $enseignant->id . "\n\n";

    // Créer l'utilisateur Admin
    echo "🔧 Création de l'utilisateur Administrateur...\n";
    
    $admin = User::updateOrCreate(
        ['email' => 'admin@test.com'],
        [
            'name' => 'Admin Test',
            'email' => 'admin@test.com',
            'password' => Hash::make('password'),
            'role' => 'admin',
            'email_verified_at' => now(),
        ]
    );
    
    echo "✅ Administrateur créé/mis à jour:\n";
    echo "   Email: admin@test.com\n";
    echo "   Mot de passe: password\n";
    echo "   Rôle: admin\n";
    echo "   ID: " . $admin->id . "\n\n";

    // Afficher le résumé
    echo "╔════════════════════════════════════════════════════════╗\n";
    echo "║              ✅ SUCCÈS - Utilisateurs Créés            ║\n";
    echo "╚════════════════════════════════════════════════════════╝\n\n";

    echo "📋 IDENTIFIANTS DE CONNEXION\n";
    echo "════════════════════════════════════════════════════════\n\n";

    echo "👨‍🏫 ENSEIGNANT:\n";
    echo "   Email:    enseignant@test.com\n";
    echo "   Password: password\n";
    echo "   URL:      http://localhost:8000\n";
    echo "   Rôle:     Sélectionner l'onglet 'Enseignant'\n\n";

    echo "🔧 ADMINISTRATEUR:\n";
    echo "   Email:    admin@test.com\n";
    echo "   Password: password\n";
    echo "   URL:      http://localhost:8000\n";
    echo "   Rôle:     Sélectionner l'onglet 'Admin'\n\n";

    echo "════════════════════════════════════════════════════════\n\n";

    echo "🚀 PROCHAINES ÉTAPES:\n";
    echo "   1. Lancer le serveur: php artisan serve\n";
    echo "   2. Aller à: http://localhost:8000\n";
    echo "   3. Tester les deux rôles avec les identifiants ci-dessus\n\n";

} catch (Exception $e) {
    echo "❌ ERREUR: " . $e->getMessage() . "\n";
    exit(1);
}

echo "✨ Script terminé avec succès!\n\n";
exit(0);
